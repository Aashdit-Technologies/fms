import{u as E,a as T,b as h,r as p,y as r,j as e,P as O,L as z}from"./index-CU8vfzW6.js";import{u as w,e as L,a as v,G,c as R,T as M,I as N,F as U,M as _,b as S,d as D,f as V,g as W,B as P,h as Q}from"./cggovt-W4HAS40Q.js";import $ from"./SVGComponent-CP1hrFio.js";const q=()=>{const s=E(),x=T(),c=h(t=>t.setToken),[b,C]=p.useState(""),j=h(t=>t.setShowCaptchaField),u=w({mutationFn:async t=>{try{if(t.userName){if(!t.password)return r.error("Please enter password."),!1}else return r.error("Please enter username."),!1;const i={size:5,userName:t.userName},d=L(i),l=await v.post("allow/captcha",{dataObject:d},{responseType:"arraybuffer"}),o=btoa(new Uint8Array(l.data).reduce((n,f)=>n+String.fromCharCode(f),""));return C(`data:image/png;base64,${o}`),j(!0),!0}catch(i){return console.error("Error fetching Captcha data:",i),r.error("Failed to generate captcha. Please try again.",{autoClose:1e3}),!1}}}),g=w({mutationFn:async t=>{var i,d;try{const l={userName:t.userName,password:t.password,captcha:t.userCaptcha,byPassCaptcha:!1},o=L(l),n=await v.post("/umt/login",{dataObject:o});return n.data.outcome||await u.mutateAsync({userName:t.userName,password:t.password}),n.data}catch(l){await u.mutateAsync({userName:t.userName,password:t.password});const o=((d=(i=l.response)==null?void 0:i.data)==null?void 0:d.message)||l.message||"Login failed.";throw r.error(o),new Error(o)}},onSuccess:t=>{t!=null&&t.outcome?(c(t.data),x.invalidateQueries(["user"]),s("/")):r.error(t.message||"Login failed.")},onError:t=>{r.error(t.message||"Login failed.")}}),y=w({mutationFn:async()=>{try{const t=h.getState().token;await v.post("/umt/logout",{},{headers:{Authorization:`Bearer ${t}`}}),h.getState().clearAuth(),x.clear(),s("/login")}catch(t){throw r.error("Logout error:",t),t}},onSuccess:()=>{r.success("Logout successful!")},onError:t=>{r.error(t.message||"Logout failed.")}});return{login:g.mutate,logout:y.mutate,isLoggingIn:g.isLoading,isLoggingOut:y.isLoading,captcha:b,generateCaptcha:u.mutate}};function K(s){return G({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M218.1 167.2c0 13 0 25.6 4.1 37.4-43.1 50.6-167.5 194.5-167.5 194.5l2.9 36.3s34.8 33 40 28c15.4-15 24.8-25.2 24.8-25.2l7.24-43.35 47.11-3.47 3.78-46.8 49.63-.95.49-50.09 52.69 2.1 9-18.84c15.5 6.7 29.6 9.4 47.7 9.4 68.5 0 124-53.4 124-119.2S408.5 48 340 48s-121.9 53.4-121.9 119.2zM406.85 144A38.85 38.85 0 1 1 368 105.15 38.81 38.81 0 0 1 406.85 144z"},child:[]}]})(s)}const X=()=>{const[s,x]=p.useState(""),[c,b]=p.useState(""),[C,j]=p.useState(!1),[u,g]=p.useState(""),{login:y,isLoggingIn:t,captcha:i,generateCaptcha:d}=q();h.getState().token;const[l,o]=p.useState(!1),n=h(a=>a.setShowCaptchaField),f=h(a=>a.showCaptchaField);p.useEffect(()=>{n(!1)},[n]);const F=a=>{const m=a.target.value.trim();x(m),m.trim()||n(!1)},k=async()=>{if(!s.trim())return r.error("Please enter username.",{autoClose:1e3}),!1;if(!c.trim())return r.error("Please enter password.",{autoClose:1e3}),!1;try{return o(!0),await d({userName:s,password:c}),n(!0),!0}catch{return r.error("Failed to generate captcha. Please try again.",{autoClose:1e3}),!1}finally{o(!1)}},A=async a=>{if(a.preventDefault(),!s.trim()){r.error("Please enter username.",{autoClose:1e3});return}if(!c.trim()){r.error("Please enter password.",{autoClose:1e3});return}if(f&&!u.trim()){r.error("Please enter the captcha.",{autoClose:1e3});try{await I()}catch(m){console.error("Failed to refresh captcha:",m)}return}try{await y({userName:s,password:c,userCaptcha:u}),g("")}catch{r.error("Login failed. Please try again.",{autoClose:1e3})}},B=()=>{j(a=>!a)},I=async()=>{try{await d({userName:s,password:c}),g("")}catch{r.error("Failed to refresh captcha. Please try again.",{autoClose:1e3})}};return e.jsxs(e.Fragment,{children:[l&&e.jsx(O,{}),e.jsxs("div",{className:"login_main",children:[e.jsxs("div",{className:"container",children:[e.jsx("div",{className:"log-logo-sec",children:e.jsx(z,{to:"/",style:{textDecoration:"none"},children:e.jsxs("div",{className:"logo_sec_main",style:{display:"flex",alignItems:"center",justifyContent:"start",textDecoration:"none",gap:"10px"},children:[e.jsx("img",{src:R,alt:""}),e.jsxs("div",{className:"logo_head mt-3",children:[e.jsx("h2",{children:"FILE MANAGEMENT SYSTEM"}),e.jsx("h6",{children:"Government of Chhattisgarh"})]})]})})}),e.jsx("div",{className:"left_fig",children:e.jsx($,{})})]}),e.jsx("div",{className:"container-fluid",children:e.jsx("div",{className:"container cntr_cls",children:e.jsxs("div",{className:"box",children:[e.jsx("div",{className:"shadow"}),e.jsx("div",{className:"content",children:e.jsxs("div",{className:"form",children:[e.jsx("h3",{className:"logos",children:e.jsx(K,{})}),e.jsx("h2",{children:"Log in"}),e.jsxs("form",{onSubmit:A,children:[e.jsx("div",{className:"inputBox",children:e.jsx(M,{label:"User Id",variant:"outlined",fullWidth:!0,value:s,onChange:F,autoComplete:"off",size:"small",inputProps:{maxLength:250},InputProps:{startAdornment:e.jsx(N,{position:"start",children:e.jsx(U,{color:"rgb(200 98 255)"})})},margin:"normal",sx:{"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#c264f4"},"&.Mui-focused fieldset":{borderColor:"#c264f4"},"&:hover fieldset":{borderColor:"#c264f4"}},"& .MuiInputBase-input":{color:"#ccc"},"& .MuiInputLabel-root":{color:"#ccc"},"& .MuiInputLabel-root.Mui-focused":{color:"#ccc"},"& .MuiInputBase-input::placeholder":{color:"#c264f4"}}})}),e.jsx("div",{className:"inputBox",children:e.jsx(M,{label:"Password",variant:"outlined",size:"small",inputProps:{maxLength:250},fullWidth:!0,type:C?"text":"password",value:c,onChange:a=>b(a.target.value),autoComplete:"off",margin:"normal",InputProps:{startAdornment:e.jsx(N,{position:"start",children:e.jsx(_,{color:"rgb(200 98 255)",size:20})}),endAdornment:e.jsx(N,{position:"end",children:e.jsx(S,{onClick:B,edge:"end",children:C?e.jsx(D,{color:"rgb(200 98 255)"}):e.jsx(V,{color:"rgb(200 98 255)"})})})},sx:{"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#c264f4"},"&.Mui-focused fieldset":{borderColor:"#c264f4"},"&:hover fieldset":{borderColor:"#c264f4"}},"& .MuiInputBase-input":{color:"#ccc"},"& .MuiInputLabel-root":{color:"#ccc"},"& .MuiInputLabel-root.Mui-focused":{color:"#ccc"},"& .MuiInputBase-input::placeholder":{color:"#c264f4"}}})}),f&&e.jsx("div",{className:"inputBox",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[e.jsx(M,{label:"Enter Captcha",variant:"outlined",fullWidth:!0,value:u,onChange:a=>g(a.target.value),autoComplete:"off",margin:"normal",sx:{"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#c264f4"},"&.Mui-focused fieldset":{borderColor:"#c264f4"},"&:hover fieldset":{borderColor:"#c264f4"}},"& .MuiInputBase-input":{color:"#ccc"},"& .MuiInputLabel-root":{color:"#ccc"},"& .MuiInputLabel-root.Mui-focused":{color:"#ccc"},"& .MuiInputBase-input::placeholder":{color:"#c264f4"},flex:4},size:"small"}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#c264f4 ",border:"1px solid #c264f4",borderRadius:"6px",padding:"6px",width:"80px",marginTop:"6px",height:"41px"},children:e.jsx("img",{src:i,alt:"Captcha",style:{height:"25px",width:"auto"}})}),e.jsx(S,{onClick:I,style:{backgroundColor:"#c264f4",borderRadius:"6px",padding:"6px",height:"40px",marginTop:"6px",width:"45px",transition:"background-color 0.3s ease"},onMouseOver:a=>a.currentTarget.style.backgroundColor="#c264f4",onMouseOut:a=>a.currentTarget.style.backgroundColor="#c264f4",children:e.jsx(W,{style:{color:"#fff"}})})]})}),e.jsx("div",{className:"inputBox d-flex justify-content-center",children:f?e.jsx(P,{type:"submit",style:{backgroundColor:"#440571",color:"rgb(255, 255, 255)",border:"1px solid #440571"},startIcon:e.jsx(Q,{style:{paddingRight:"5px"}}),className:"",children:"Login"}):e.jsx(P,{type:"button",variant:"contained",style:{backgroundColor:"rgb(144 71 180)",color:"rgb(255, 255, 255)",border:"1px solid #aaaaaa"},className:"btn btn-secondary btn-block text-center ms-3",onClick:a=>{a.preventDefault(),k()},children:"Generate Captcha"})})]})]})})]})})})]})]})};export{X as default};
