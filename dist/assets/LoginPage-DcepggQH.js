import{u as I,a as E,b as u,r as d,y as s,j as e,L as A}from"./index-lZwyRc-4.js";import{u as w,e as M,a as v,G as T,o as B,T as N,I as S,F as O,M as G,b as L,c as U,d as _,f as R}from"./odishalogo-Dev4_ZBY.js";const z=()=>{const o=I(),p=E(),l=u(t=>t.setToken),[y,m]=d.useState(""),j=u(t=>t.setShowCaptchaField),h=w({mutationFn:async t=>{try{if(t.userName){if(!t.password)return s.error("Please enter password."),!1}else return s.error("Please enter username."),!1;const i={size:6,userName:t.userName},c=M(i),r=await v.post("allow/captcha",{dataObject:c},{responseType:"arraybuffer"}),n=btoa(new Uint8Array(r.data).reduce((f,C)=>f+String.fromCharCode(C),""));return m(`data:image/png;base64,${n}`),j(!0),!0}catch(i){return console.error("Error fetching Captcha data:",i),s.error("Failed to generate captcha. Please try again.",{autoClose:1e3}),!1}}}),g=w({mutationFn:async t=>{var i,c;try{const r={userName:t.userName,password:t.password,captcha:t.userCaptcha},n=M(r);return console.log("check payload",r),(await v.post("/umt/login",{dataObject:n})).data}catch(r){const n=((c=(i=r.response)==null?void 0:i.data)==null?void 0:c.message)||r.message||"Login failed.";throw s.error(n),new Error(n)}},onSuccess:t=>{t!=null&&t.outcome?(l(t.data),p.invalidateQueries(["user"]),o("/")):s.error(t.message||"Login failed.")},onError:t=>{s.error(t.message||"Login failed.")}}),x=w({mutationFn:async()=>{try{const t=u.getState().token;await v.post("/umt/logout",{},{headers:{Authorization:`Bearer ${t}`}}),u.getState().clearAuth(),p.clear(),o("/login")}catch(t){throw s.error("Logout error:",t),t}},onSuccess:()=>{s.success("Logout successful!")},onError:t=>{s.error(t.message||"Logout failed.")}});return{login:g.mutate,logout:x.mutate,isLoggingIn:g.isLoading,isLoggingOut:x.isLoading,captcha:y,generateCaptcha:h.mutate}},D="/assets/left-img-abpuQ1wM.png";function Q(o){return T({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M218.1 167.2c0 13 0 25.6 4.1 37.4-43.1 50.6-167.5 194.5-167.5 194.5l2.9 36.3s34.8 33 40 28c15.4-15 24.8-25.2 24.8-25.2l7.24-43.35 47.11-3.47 3.78-46.8 49.63-.95.49-50.09 52.69 2.1 9-18.84c15.5 6.7 29.6 9.4 47.7 9.4 68.5 0 124-53.4 124-119.2S408.5 48 340 48s-121.9 53.4-121.9 119.2zM406.85 144A38.85 38.85 0 1 1 368 105.15 38.81 38.81 0 0 1 406.85 144z"},child:[]}]})(o)}const $=()=>{const[o,p]=d.useState(""),[l,y]=d.useState(""),[m,j]=d.useState(!1),[h,g]=d.useState(""),{login:x,isLoggingIn:t,captcha:i,generateCaptcha:c}=z();u.getState().token,console.log("captcha",i);const r=u(a=>a.setShowCaptchaField),n=u(a=>a.showCaptchaField);d.useEffect(()=>{r(!1)},[r]);const f=a=>{const b=a.target.value;p(b),b.trim()||r(!1)},C=async()=>{if(console.log("Generate Captcha button clicked"),!o.trim())return s.error("Please enter username.",{autoClose:1e3}),!1;if(!l.trim())return s.error("Please enter password.",{autoClose:1e3}),!1;try{return await c({userName:o,password:l}),r(!0),!0}catch{return s.error("Failed to generate captcha. Please try again.",{autoClose:1e3}),!1}},P=async a=>{if(a.preventDefault(),console.log("Form submitted"),!o.trim()){s.error("Please enter username.",{autoClose:1e3});return}if(!l.trim()){s.error("Please enter password.",{autoClose:1e3});return}if(n&&!h.trim()){s.error("Please enter the captcha.",{autoClose:1e3});return}try{await x({userName:o,password:l,userCaptcha:h})}catch{s.error("Login failed. Please try again.",{autoClose:1e3})}},k=()=>{j(a=>!a)},F=async()=>{try{await c({userName:o,password:l}),g("")}catch{s.error("Failed to refresh captcha. Please try again.",{autoClose:1e3})}};return e.jsxs("div",{className:"login_main",children:[e.jsxs("div",{className:"container",children:[e.jsx("div",{className:"log-logo-sec",children:e.jsx(A,{to:"/",style:{textDecoration:"none"},children:e.jsxs("div",{className:"logo_sec_main",style:{display:"flex",alignItems:"center",justifyContent:"start",textDecoration:"none",gap:"10px"},children:[e.jsx("img",{src:B,alt:""}),e.jsxs("div",{className:"logo_head mt-3",children:[e.jsx("h2",{children:"FILE MANAGEMENT SYSTEM"}),e.jsx("h6",{children:"Higher Education Information & Management System"})]})]})})}),e.jsx("div",{className:"left_fig",children:e.jsx("img",{src:D,alt:""})})]}),e.jsx("div",{className:"container-fluid",children:e.jsx("div",{className:"container cntr_cls",children:e.jsxs("div",{className:"box",children:[e.jsx("div",{className:"shadow"}),e.jsx("div",{className:"content",children:e.jsxs("div",{className:"form",children:[e.jsx("h3",{className:"logos",children:e.jsx(Q,{})}),e.jsx("h2",{children:"Log in"}),e.jsxs("form",{onSubmit:P,children:[e.jsx("div",{className:"inputBox",children:e.jsx(N,{label:"User Id",variant:"outlined",fullWidth:!0,value:o,onChange:f,autoComplete:"off",InputProps:{startAdornment:e.jsx(S,{position:"start",children:e.jsx(O,{})})},margin:"normal"})}),e.jsx("div",{className:"inputBox",children:e.jsx(N,{label:"Password",variant:"outlined",fullWidth:!0,type:m?"text":"password",value:l,onChange:a=>y(a.target.value),autoComplete:"off",margin:"normal",InputProps:{startAdornment:e.jsx(S,{position:"start",children:e.jsx(G,{})}),endAdornment:e.jsx(S,{position:"end",children:e.jsx(L,{onClick:k,edge:"end",children:m?e.jsx(U,{}):e.jsx(_,{})})})}})}),n&&e.jsx("div",{className:"inputBox",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[e.jsx(N,{label:"Enter Captcha",variant:"outlined",fullWidth:!0,value:h,onChange:a=>g(a.target.value),autoComplete:"off",margin:"normal",sx:{"& .MuiOutlinedInput-root":{height:"45px"},flex:4}}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f5f5f5",border:"1px solid #e0e0e0",borderRadius:"6px",padding:"6px",height:"45px",width:"80px",marginTop:"5px"},children:e.jsx("img",{src:i,alt:"Captcha",style:{height:"30px",width:"auto"}})}),e.jsx(L,{onClick:F,style:{backgroundColor:"#f5f5f5",borderRadius:"6px",padding:"6px",height:"45px",width:"45px",transition:"background-color 0.3s ease",marginTop:"5px"},onMouseOver:a=>a.currentTarget.style.backgroundColor="#e0e0e0",onMouseOut:a=>a.currentTarget.style.backgroundColor="#f5f5f5",children:e.jsx(R,{style:{color:"#207785"}})})]})}),e.jsx("div",{className:"inputBox d-flex justify-content-center",children:n?e.jsx("button",{type:"submit",className:"btn btn-primary btn-block text-center",children:"Login"}):e.jsx("button",{type:"button",className:"btn btn-secondary btn-block text-center ms-3",onClick:a=>{a.preventDefault(),C()},children:"Generate Captcha"})})]})]})})]})})})]})};export{$ as default};
